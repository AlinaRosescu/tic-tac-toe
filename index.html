<!DOCTYPE html>
<html>
    <head>
        <title>Tic-Tac-Toe</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Sriracha" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="styles.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script type="text/javascript" type="text/css" href="styles.css"></script>
    </head>
    <body>
      <div class="container">
         <h1>Tic Tac Toe</h1>
         <h2>Do you wanna play a game?</h2>
         <button name="start" type="button" id="start">Start game</button>
         <button name="restart" type="button" id="restart">Restart game</button>
         <div class="result">
         </div>
         <div id="grid">
         </div>
      </div>

    <script>
        //var game = false;
        //var status;
        //var currentPlayer;
        //var divId;
        var round;
        //var result;
        var gameGrid = [];
        //var updatedWinCases;
        var winCases = [
            ["0","1","2"],
            ["3","4","5"],
            ["6","7","8"],
            ["0","3","6"],
            ["1","4","7"],
            ["2","5","8"],
            ["2","4","6"],
            ["0","4","8"]
        ];
        //var chosenDiv;
        //var isAvailable = false;

    //start game
    $(".container").on("click", "button", startGame);

    //initialize variables and add click event on grid
    function startGame() {
        round = 1;

        //status = "playing";

        $("#grid").empty();
        $(".result").empty();
        createGrid();


        //for (let i = 1; i <= 5; i++) {
            //if (gameIsPlaying !== false) {
               //movePlayer1(game);
            //}
        //}
        $("#grid").on("click", "div", movePlayer1);

        //return gameIsPlaying;
    }


    //create game 3x3 grid and set array with value E from empty
    function createGrid() {
        //if ($("#grid").children("div").length > 0) {
            //$("#grid").empty();
            //$(".result").empty();
        //}

        $("#grid").css("display", "block");
        $("#start").css("display", "none");
        $("#restart").css("display", "block");
        for (let i = 0; i < 9; i++) {
            var square = document.createElement("div");
            document.getElementById("grid").appendChild(square);
            square.id = i;
            gameGrid[i] = "E";
        }
    }

    // register user clicks and moves
    function movePlayer1() {
        //$("#grid").on("click", "div", function() {
        var player = "X";
        //currentPlayer = "X";
        var selectedDivId = $(this).attr("id");

        //if (!($(this).attr("disabled"))) {
        if(checkIsDivAvailable(selectedDivId)) {
            $(this).html("<p>X</p>");
            $(this).css("color", "#09958d");
            //$(this).attr("disabled", "true");
            //divId = $(this).attr("id");
            gameGrid[selectedDivId] = "X";

            //updatedWinCases = winCases.map(updateWinCases);
            //checkResults(currentPlayer);
            //checkResults(player);
            var isGamePlaying = checkResults(player);

            if (isGamePlaying) {
                movePlayer2(selectedDivId);
            }
        }
        //});
    }

    //make computer moves
    function movePlayer2(userMove) {
        var userChoice = parseInt(userMove);
        //currentPlayer = "O";
        var player = "O";
        var chosenDiv;
        var divId;

        if(round === 1) {
            if (userChoice !== 4) {
                divId = 4;
                //checkIsDivAvailable();
            } else if (userChoice === 4) {
                /*do {
                    var randomId = Math.floor(Math.random() * (8 - 0 + 1)) + 0;
                    if (randomId % 2 === 0) {
                        divId = randomId;
                        checkIsDivAvailable(divId);
                    }
                } while (!checkIsDivAvailable(divId) || randomId % 2 !== 0);*/
                divId = getRandomNumber();
            }
        } else {
            var player1 = "O";
            var player2 = "X";
            /*var block =  false;
            var win = false;
            var divIdBlock;
            var divIdWin;*/

            for (let i = 0; i < 2; i++) {
                divId = checkAvailableComputerMove(player1, player2,divId);
                if (!divId) {
                    player1 = "X";
                    player2 = "O";
                }
            }

            //go through the updated win cases twice
            //for (let i = 0; i < 2; i++) {
                /*updatedWinCases.forEach(function (element) {
                    if (element[0] === one) {
                        if (element[1] === one &&  element[2] !== two) {
                           divId = element[2];
                        } else if (element[2] === one &&  element[1] !== two) {
                           divId = element[1];
                        }
                    } else if (element[1] === one) {
                        if (element[2] === one &&  element[0] !== two) {
                           divId = element[0];
                        }
                    }
                })*/

                /*winCases.forEach(function (element) {
                    if (gameGrid[element[0]] === one) {
                        if (gameGrid[element[1]] === one &&  gameGrid[element[2]] !== two) {
                           divId = element[2];
                        } else if (gameGrid[element[2]] === one &&  gameGrid[element[1]] !== two) {
                           divId = element[1];
                        }
                    } else if (gameGrid[element[1]] === one) {
                        if (gameGrid[element[2]] === one &&  gameGrid[element[0]] !== two) {
                           divId = element[0];
                        }
                    }
                })*/

                //divId = checkAvailableComputerMove(player1, player2,divId);

                //check if either X or O is about to win
                /*if (one === "X") {
                    block = true;
                    divIdBlock = divId;
                    checkIsDivAvailable(divIdBlock);
                } else if (one === "O") {
                    win = true;
                    divIdWin = divId;
                    checkIsDivAvailable(divIdWin);
                }
                var one = "O";
                var two = "X";*/
            //}

            //if both have a chance to win choose to win else choose to block
            /*if (win === true) {
                chosenDiv = $(document.getElementById(divIdWin));
            } else if (block === true){
                chosenDiv = $(document.getElementById(divIdBlock));
            }*/

            //if neither have a chance to win, place O in the first available div
            //if (!isAvailable)  {

            if (!divId)  {
                //do {
                    /*updatedWinCases.forEach(function (element) {
                        for (let i = 0; i < element.length; i++) {
                           if (element[i] !== one && element[i] !== two) {
                              divId = element[i];
                              checkIsDivAvailable(divId);
                              break;
                           }
                        }
                    })*/
                    //winCases.forEach(function (element) {
                        for (let i = 0; i < gameGrid.length; i++) {
                            //if (gameGrid[element[i]] !== one && gameGrid[element[i]] !== two) {
                            if (checkIsDivAvailable(i)) {
                              divId = i;
                              //checkIsDivAvailable(divId);
                              //break;
                           }
                        }

                //} while(!divId);
                //} while(!isAvailable);
            }
        }//close if else

        //select div where to add O
        chosenDiv = $(document.getElementById(divId));

        chosenDiv.css("color", "#fc2c54");
        chosenDiv.html("<p>0</p>").delay(800);
        //chosenDiv.attr("disabled", "true");
        gameGrid[divId] = "O";
        round++;
        //updatedWinCases = winCases.map(updateWinCases);
        //checkResults(currentPlayer);
        checkResults(player);
        console.log("ddd");
    }

    //generate a random even number between 0 and 9
    function getRandomNumber() {
        var randomNr;
        do {
            randomNr = Math.floor(Math.random() * (8 - 0 + 1)) + 0;
            if (checkIsDivAvailable(randomNr) && randomNr % 2 === 0) {

                return randomNr;
            }
        } while (!checkIsDivAvailable(randomNr) || randomNr % 2 !== 0);
    }

    //check if computer can win or block
    function checkAvailableComputerMove(player1,player2,divId) {
        winCases.forEach(function (item) {
            if (gameGrid[item[0]] === player1 && gameGrid[item[1]] === player1 &&  gameGrid[item[2]] !== player2) {
                divId = item[2];
            } else if (gameGrid[item[0]] === player1 && gameGrid[item[2]] === player1 &&  gameGrid[item[1]] !== player2) {
                divId = item[1];
            } else if (gameGrid[item[1]] === player1 && gameGrid[item[2]] === player1 &&  gameGrid[item[0]] !== player2) {
                divId = item[0];
            }
        });

        return divId;
    }

    // check if selected div is available
    function checkIsDivAvailable(div) {
        //chosenDiv = $(document.getElementById(div));
        //if (!(chosenDiv.attr("disabled"))) {
            //isAvailable = true;
        //} else {
            //isAvailable = false;
        //}
        //return isAvailable;

        return gameGrid[div] === "E";
    }


    //update the win case array with player's moves
   /* function updateWinCases(item) {
        for (let i = 0; i < item.length; i++) {
            if (item[i] == divId) {
               item[i] = currentPlayer;
            }
        }
        return item;
    }*/

      //check if either player has won, the game ends in a draw or game is still going
    function checkResults(player) {

    winCases.forEach(function (elem) {
        if (gameGrid[elem[0]] === player && gameGrid[elem[1]] === player && gameGrid[elem[2]] === player) {
            endGame(player);

            return false;
        }
    })

    for (let i = 0; i < gameGrid.length; i++) {
        if (gameGrid[i] === "E") {

            return true;
        } else if (i === 8 && gameGrid[i] !== "E") {
            endGame("It's a draw");

            return false;
        }
    }
}


    //if game has ended alert the user of the result
    function endGame(result) {
        //game = false;
        //status = "over";

        $("#grid").off("click", "div");
        //if (result === "X" || result === "O") {
        if (result === "X") {
           $(".result").css("color", "#09958d");
           $(".result").append("<p>" + result +" has won!</p>");
        } else if (result === "O") {
           $(".result").css("color", "#fc2c54");
           $(".result").append("<p>" + result +" has won!</p>");
        } else {
            $(".result").append("<p>" + result + "</p>");
            $(".result").css("color", "#076762");
        }
    }


    </script>
    </body>
</html>




